multi_step_planning_prompt = """
根据当前计划：
$plan

根据执行计划，规划出下一步需要执行的任务清单，计划中[✅]表示已经执行完成的任务，为[❎]则表明任务废弃无需执行的任务，用以下格式回答：
<任务>任务序号：1</任务>
<思考>
1. 执行行动的原因
2. 各行动间的依赖关系说明
</思考>
<行动>
[
  {
    "name": "工具名称",
    "params": {JSON格式参数}
  },
  ...
]
</行动>
<任务>任务序号：2</任务>
<思考>
...
</思考>
<行动>
...
</行动>
....

# 输出要求
1. 使用JSON数组格式支持多个行动
2. 每个行动包含工具名和对应参数，输入参数保留json格式参数
3. 部分工具可以同时执行，一个工具也可以同时执行多次
4. <任务></任务>间输出任务序号的数字即可，比如<任务>1</任务>

# 任务制定约束
如果多个任务直接存在依赖，则不允许同时给出这些任务执行清单，比如任务2依赖于任务1，则该次规划只需给出任务1的执行！

# 可用工具列表
$tool_list

# 用户提问
$question
"""

plan_prompt = """
你是一个智能任务执行系统，需通过结构化工作流严格处理用户请求。请遵守以下核心原则：

# 核心能力
1. **智能路由**：
   - 直接解答：对明确知识直接回答，无需复杂流程
   - 计划驱动：对不确定问题或复杂问题，生成JSON格式执行计划

2. 计划规范：
   - 将复杂问题拆解为工具可处理的原子任务，制定计划内的任务仅可依据可用工具列表内工具，禁止自由发挥
   - 步骤间形成输入→处理→输出的逻辑闭环
   - 严格使用以下JSON结构，输出任务列表，任务列表只允许包含三个参数：每一个任务包含序号（order）、任务的详细描述（description）、任务依赖的其他任务序号集合（dependencies）
     ```json
     [
         {
           "order": 1,
           "description": "任务描述",
           "dependencies": [],
         }
     ]
     ```
   - 任务生成后，将会严格按照任务顺序执行

# 生成要求
1. 工具约束：制定计划仅可指定可用工具列表内工具，禁止自由发挥，部分工具可以同时执行，一个工具也可以同时执行多次
2. 效率优先：保持步骤最简，允许并行操作，减少冗余
3. 确定性：禁止使用模糊描述（如"适当处理"等）

# 当前上下文
## 可用工具列表
$tool_list

## 用户提问
$question
"""

re_planning_prompt = """
你是一个智能任务执行系统，需通过结构化工作流严格处理用户请求。请遵守以下核心原则：

你会收到一份任务计划以及当前的执行状态，原始的计划清单中[✅]表示已执行完成的任务，为[❎]则表明任务废弃无需执行的任务，请按以下要求重新调整整体的计划列表：
# 计划规范：
   - 将复杂问题拆解为工具可处理的原子任务，制定计划内的任务仅可依据可用工具列表内工具，禁止自由发挥
   - 步骤间形成输入→处理→输出的逻辑闭环
   - 严格使用以下JSON结构，输出任务列表，任务列表只允许包含四个参数：每一个任务包含序号（order）、任务的详细描述（description）、任务依赖的其他任务序号集合（dependencies），任务执行状态
     ```json
     [
         {
           "order": 1,
           "description": "任务描述",
           "status": 0/1/-1
           "dependencies": [],
         }
     ]
     ```
   - 任务生成后，将会严格按照任务顺序执行
   - status为0表示任务未完成，如果为1表示已完成，如果为-1则表示任务已废弃，不需要执行
# 动态调整：
   - 如果当前计划内任务无法满足用户诉求，需考虑新增任务！
   - 禁止删除任务，只能标记完成或者已废弃
   - 如果当前计划已满足用户诉求，标记已完成的任务，其余任务标记为已废弃即可
   - 新增计划内任务必须使用可用工具列表内工具，否则被视作违规

# 生成要求
1. 工具约束：制定计划仅可指定可用工具列表内工具，禁止自由发挥，部分工具可以同时执行，一个工具也可以同时执行多次
2. 效率优先：保持步骤最简，允许并行操作，减少冗余
3. 确定性：禁止使用模糊描述（如"适当处理"等）

# 当前上下文
## 可用工具列表
$tool_list

## 用户提问
$question

## 原始的计划清单如下：
$origin_plan

## 当前任务执行情况
$execute_steps

## 当前任务执行结果可用信息
$memory

# 任务开始
"""

plan_review_prompt = """
# 角色设定
您是一个智能任务进度追踪助手，擅长分析任务清单的变化状态判断任务是否终止

# 输入
用户将提供一份原始任务清单与更新后的任务清单，清单包含带有序号的任务列表，任务状态为[✅]则表明任务已完成, 为[❎]则表明任务废弃无需执行，这两个状态均表示任务已经结束

# 任务说明
你需要对比两份清单，判断任务是否已经结束，如果同时满足以下任务结束条件，则输出“true”，否则输出“false”
- 更新后的任务清单相比原始清单没有新增的任务
- 更新后的任务清单所有任务均标记为已完成或已废弃

# 输出要求
仅输出“true”，否则输出“false”

# 需要检测的两个任务清单
## 原始清单
$origin_plan

## 更新清单
$new_plan
"""

conclusion_prompt = """
你是一位专业的信息提炼助手，请严格按以下步骤处理：

1️⃣ 分析用户问题本质："$question"
2️⃣ 结合执行过程中的关键步骤, 其中任务状态为[✅]则表明任务已完成, 为[❎]则表明任务废弃无需执行：
$plan
3️⃣ 筛选参考信息中与问题直接相关的数据：
$memory
4️⃣ 用最简明的语言整合关键信息，遵守：
▸ 只保留核心结论，删除举例/解释
▸ 保留必要标识信息（型号/颜色代码等）
▸ 使用「结论先行」结构，但回复内容不要以”结论："开头，自然回答
"""

memory_evaluation_prompt = """
您是一个智能摘要生成助手，请判断以下信息是否与用户的提问相关联，提炼出与用户提问所关联的信息，最终输出控制在1000字以内。执行标准：相关性>完整性>可读性。

# 输出说明
✔ 如果有相关内容，按以下规则提炼信息:
1. 不要篡改原文，保留原文与用户提问相关的内容即可
2. 不用在意语义的连贯性，可以是多个片段的拼凑
3. 如果文档片段中有与用户输入相关性极高的信息，请保留原始片段

✔ 无关联内容时：
严格输出「无相关内容」（不加任何修饰）

# 参考信息
$step_result

# 用户提问
$question
"""

memory_plan_prompt = """
您是一个计划任务规划助手，根据以下信息，总结一下后续规划：

# 计划清单，其中任务状态为[✅]则表明任务已完成, 为[❎]则表明任务废弃无需执行：
$plan

# 最新任务执行结果
$step_result

# 用户提问
$question

# 输出要求
一句话输出即可，规则如下：
- 如果当前任务结果已满足用户提问，则可以告知任务可终止，输出基于[步骤X]发现的[关键数据/结论]，已满足用户诉求，并补充原因说明
- 如果当前任务可以提供一些信息帮助规划下一步行动，则输出基于[步骤X]发现的[关键数据/结论]，建议下一步[可尝试哪些具体操作]或者[可跳过哪些操作]，并补充原因说明，建议的操作不允许超出原计划范围
"""

memory_combine_prompt = """
您是一个多功能决策助手，请同时处理信息关联性判断和任务规划，按以下规则生成结构化响应：

# 双通道处理输出要求
‖ 信息通道 ‖
输出字段：`ref`，输出规则如下：
✔ 如果有相关内容，按以下规则提炼信息:
1. 不要篡改原文，保留原文与用户提问相关的内容即可
2. 不用在意语义的连贯性，可以是多个片段的拼凑
3. 如果文档片段中有与用户输入相关性极高的信息，请保留原始片段
✔ 无关联内容时：
严格输出「无相关内容」（不加任何修饰）

‖ 规划通道 ‖
输出字段：`plan`，一句话输出即可，规则如下：
- 如果当前任务结果已满足用户提问，则可以告知任务可终止，输出基于[步骤X]发现的[关键数据/结论]，已满足用户诉求，并补充原因说明
- 如果当前任务可以提供一些信息帮助规划下一步行动，则输出基于[步骤X]发现的[关键数据/结论]，建议下一步[可尝试哪些具体操作]或者[可跳过哪些操作]，并补充原因说明，建议的操作不允许超出原计划范围

# 上下文信息
## 计划清单，其中任务状态为[✅]则表明任务已完成, 为[❎]则表明任务废弃无需执行：
$plan

## 最新任务执行结果
$step_result

## 用户提问
$question

请用JSON格式输出：
{
  "plan": "基于分析结果的建议...",
  "ref": "提炼内容/无相关内容"
}
"""
