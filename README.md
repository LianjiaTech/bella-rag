# Bella-RAG

> Bella-RAGæ˜¯ä¸€ä¸ªåŸºäºDjangoçš„å¼€æºRAGï¼ˆRetrieval-Augmented Generationï¼‰æ¡†æ¶ï¼Œæä¾›æ–‡æ¡£ç†è§£ã€ç´¢å¼•æ„å»ºã€æ£€ç´¢é—®ç­”ç­‰å®Œæ•´çš„RAGåŸºç¡€èƒ½åŠ›ã€‚

## ğŸš€ ç‰¹æ€§

### ğŸ† æ ¸å¿ƒæŠ€æœ¯ä¼˜åŠ¿

- **ğŸ”¥ ä¸šç•Œé¢†å…ˆçš„æ–‡æ¡£è§£æ**: æ–‡æ¡£ç»“æ„åŒ–è§£ææ•ˆæœä¸šç•Œé¢†å…ˆï¼Œæ”¯æŒå¤æ‚ç‰ˆé¢å’Œå¤šæ¨¡æ€å†…å®¹ç†è§£
- **ğŸ¯ é«˜ç²¾åº¦æ£€ç´¢æŠ€æœ¯**: åˆ©ç”¨å¤šè·¯å¬å›å’Œsmall2bigæŠ€æœ¯ï¼Œå…¼é¡¾è¯­ä¹‰æ£€ç´¢æ•ˆæœä¸ä¿¡æ¯å®Œæ•´åº¦ï¼Œå¤šåœºæ™¯éªŒè¯ç»¼åˆç»“æœå¯ç”¨ç‡ > 85%
- **ğŸ§  Contextual RAGå¢å¼º**: æ”¯æŒContextual RAGæŠ€æœ¯ï¼Œåœ¨chunkç¼–ç å‰é¢„å…ˆæ·»åŠ è§£é‡Šæ€§çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¤§å¹…æå‡æ£€ç´¢å‡†ç¡®ç‡
- **ğŸš€ Deep RAGæ™ºèƒ½agentæ¨¡å¼**: åŸºäºPlanning and Solveæ¨¡å¼çš„æ™ºèƒ½agentï¼Œé€šè¿‡è‡ªåŠ¨åˆ¶å®šæ‰§è¡Œè®¡åˆ’ï¼ˆç¡®è®¤æ–‡ä»¶èŒƒå›´ -> é˜…è¯»æ–‡ä»¶ -> åæ€ï¼‰ã€æ­¥éª¤å¼æ‰§è¡Œå’ŒåŠ¨æ€é‡è§„åˆ’ï¼Œå®ç°æ¯”ä¼ ç»ŸRAGæ›´ä¼˜çš„é—®ç­”æ•ˆæœ
- **ğŸ”§ ç­–ç•¥æ’ä»¶åŒ–æ¶æ„**: æ£€ç´¢ç­–ç•¥å®Œå…¨å¯æ’æ‹”ï¼Œè°ƒç”¨æ–¹å¯æ ¹æ®ä¸šåŠ¡åœºæ™¯çµæ´»è°ƒæ•´æ£€ç´¢ç­–ç•¥åŠå‚æ•°ï¼Œæ»¡è¶³ä¸åŒé¢†åŸŸéœ€æ±‚

### ğŸ› ï¸ ç³»ç»Ÿç‰¹æ€§

- **å¤šæ ¼å¼æ–‡æ¡£æ”¯æŒ**: æ”¯æŒPDFã€Wordã€Excelã€HTMLã€Markdownç­‰å¤šç§æ–‡æ¡£æ ¼å¼
- **å‘é‡åŒ–å­˜å‚¨**: é›†æˆQdrantå‘é‡æ•°æ®åº“ï¼ˆå¼€æºç‰ˆï¼‰æˆ–è…¾è®¯å‘é‡æ•°æ®åº“ï¼ˆä¼ä¸šç‰ˆï¼‰ï¼Œæä¾›é«˜æ•ˆçš„å‘é‡å­˜å‚¨å’Œæ£€ç´¢
- **å®‰å…¨çš„æ··åˆæ¶æ„**: å‘é‡æ•°æ®åº“ä»…å­˜å‚¨å‘é‡ï¼ŒåŸå§‹å†…å®¹å®‰å…¨å­˜å‚¨åœ¨MySQLä¸­
- **çµæ´»çš„æ£€ç´¢ç­–ç•¥**: æ”¯æŒå¤šç§æ£€ç´¢æ¨¡å¼å’Œé‡æ’åºç®—æ³•
- **å¯æ‰©å±•æ¶æ„**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œå®šåˆ¶
- **å®Œæ•´çš„API**: æä¾›å®Œæ•´çš„RESTful APIæ¥å£
- **å¼‚æ­¥å¤„ç†**: æ”¯æŒKafkaå¼‚æ­¥ä»»åŠ¡å¤„ç†
- **å¯é€‰ESæ”¯æŒ**: å¯é€‰æ‹©é›†æˆElasticsearchè¿›è¡Œå…¨æ–‡æ£€ç´¢
- **ä¸€é”®åˆå§‹åŒ–**: æä¾›è‡ªåŠ¨åŒ–è„šæœ¬å¿«é€Ÿå®Œæˆç¯å¢ƒé…ç½®


## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

![ç³»ç»Ÿæ¶æ„å›¾](docs/images/system-architecture.png)![img.png](æ¡†æ¶å›¾.png)


### å¤„ç†æµç¨‹å›¾
![img.png](æµç¨‹å›¾.png)
*ä»æ–‡æ¡£ä¸Šä¼ åˆ°æ£€ç´¢é—®ç­”çš„å®Œæ•´å¤„ç†æµç¨‹*

### æ•°æ®å­˜å‚¨æ¶æ„

ke-RAGé‡‡ç”¨æ··åˆå­˜å‚¨æ¶æ„ï¼Œå°†æ•°æ®å®‰å…¨æ€§å’Œæ£€ç´¢æ•ˆç‡ç›¸ç»“åˆï¼š

**å‘é‡æ•°æ®åº“ï¼ˆQdrant/è…¾è®¯äº‘å‘é‡æ•°æ®åº“ï¼‰**ï¼š
- å­˜å‚¨æ–‡æ¡£å’Œé—®ç­”çš„å‘é‡åŒ–è¡¨ç¤º
- ä¸å­˜å‚¨åŸå§‹æ–‡æœ¬å†…å®¹ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
- æ”¯æŒé«˜æ•ˆçš„ç›¸ä¼¼åº¦æ£€ç´¢
- åŒ…å«ä¸‰ä¸ªé›†åˆï¼šä¸»æ–‡æ¡£å‘é‡ã€QAå‘é‡ã€æ–‡æ¡£æ€»ç»“å‘é‡
- æ”¯æŒä½¿ç”¨Qdrantè‡ªéƒ¨ç½²ï¼Œæˆ–è€…ä¼ä¸šç‰ˆçš„è…¾è®¯äº‘å‘é‡æ•°æ®åº“

**å…³ç³»å‹æ•°æ®åº“ï¼ˆMySQLï¼‰**ï¼š
- å­˜å‚¨æ–‡æ¡£çš„åŸå§‹å†…å®¹å’Œå…ƒæ•°æ®
- æä¾›ç»“æ„åŒ–æ•°æ®æŸ¥è¯¢èƒ½åŠ›
- ç¡®ä¿æ•°æ®çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§

**æœç´¢å¼•æ“ï¼ˆElasticsearchï¼Œå¯é€‰ï¼‰**ï¼š
- æä¾›å…¨æ–‡æ£€ç´¢èƒ½åŠ›
- è¡¥å……å‘é‡æ£€ç´¢çš„ä¸è¶³
- æ”¯æŒå¤æ‚çš„æ–‡æœ¬æŸ¥è¯¢å’Œè¿‡æ»¤

æ¶æ„ä¼˜åŠ¿ï¼š
1. **å®‰å…¨æ€§**ï¼šæ•æ„Ÿæ–‡æ¡£å†…å®¹ä¸æš´éœ²åœ¨å‘é‡æ•°æ®åº“ä¸­
2. **æ€§èƒ½**ï¼šå‘é‡æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢å„å¸å…¶èŒ
3. **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§æ£€ç´¢ç­–ç•¥çš„ç»„åˆ
4. **å¯æ‰©å±•æ€§**ï¼šå„ç»„ä»¶å¯ç‹¬ç«‹æ‰©å±•


## âš¡ å¿«é€Ÿå¼€å§‹

### ğŸ‹ Docker Compose ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/ke-RAG.git
cd ke-RAG

# 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
export OPENAI_API_KEY="your_openai_api_key"
export OPENAI_API_BASE="https://api.openai.com/v1"

# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# 5. éªŒè¯æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:8008/api/actuator/health/liveness
```

### ğŸ¯ å‘é‡æ•°æ®åº“é€‰æ‹©

ke-RAG æ”¯æŒå¤šç§å‘é‡æ•°æ®åº“ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š

#### ğŸ”¥ Qdrantï¼ˆå¼€æºç‰ˆï¼Œæ¨èï¼‰
- âœ… **å®Œå…¨å¼€æºå…è´¹**ï¼šMITè®¸å¯è¯ï¼Œæ— ä½¿ç”¨é™åˆ¶
- âœ… **æœ¬åœ°éƒ¨ç½²**ï¼šæ•°æ®å®Œå…¨å¯æ§ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡
- âœ… **ä¸€é”®å¯åŠ¨**ï¼šDocker Compose è‡ªåŠ¨éƒ¨ç½²å’Œåˆå§‹åŒ–
- âœ… **é«˜æ€§èƒ½**ï¼šRustç¼–å†™ï¼Œå†…å­˜å ç”¨ä½ï¼Œæ£€ç´¢é€Ÿåº¦å¿«
- âœ… **æ˜“æ‰©å±•**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•å’Œåˆ†å¸ƒå¼éƒ¨ç½²

#### ğŸ¢ è…¾è®¯äº‘å‘é‡æ•°æ®åº“ï¼ˆä¼ä¸šç‰ˆï¼‰
- âœ… **æ‰˜ç®¡æœåŠ¡**ï¼šæ— éœ€è¿ç»´ï¼Œè‡ªåŠ¨å¤‡ä»½å’Œé«˜å¯ç”¨
- âœ… **ä¼ä¸šçº§**ï¼šæ”¯æŒå¤§è§„æ¨¡æ•°æ®å’Œé«˜å¹¶å‘è®¿é—®
- âœ… **å®Œæ•´ç”Ÿæ€**ï¼šä¸è…¾è®¯äº‘å…¶ä»–æœåŠ¡æ·±åº¦é›†æˆ
- âš™ï¸ **éœ€è¦é…ç½®**ï¼šéœ€è¦è…¾è®¯äº‘è´¦å·å’ŒAPIå¯†é’¥

#### é…ç½®è¯´æ˜
```bash
# é»˜è®¤ä½¿ç”¨Qdrant
docker-compose up -d

# ä½¿ç”¨è…¾è®¯å‘é‡æ•°æ®åº“éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶
# ç¼–è¾‘ conf/config_docker.iniï¼š
[VECTOR_DB]
type = tencent  # æ”¹ä¸º tencent

[TENCENT_VECTOR_DB]
url = your_tencent_vectordb_url
key = your_api_key
database_name = your_database
# ... å…¶ä»–é…ç½®
```

### ğŸ“ åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

```bash
# 1. ç´¢å¼•æ–‡æ¡£
curl --location 'http://localhost:8008/api/file/indexing' \
  --header 'Authorization: Bearer {OPEN_API_KEY}' \
  --header 'Content-Type: application/json' \
  --data '{
    "file_id": "test-file-001",
    "file_name": "example.md",
    "user": "1000000029406069"
  }'

# 2. æ£€ç´¢é—®ç­”
curl --location 'http://localhost:8008/api/rag/search' \
  --header 'Authorization: Bearer {OPEN_API_KEY}' \
  --header 'Content-Type: application/json' \
  --data '{
    "query": "ä½ å¥½",
    "scope": [
        {
            "type": "file",
            "ids": [
                "FILE_ID"
            ]
        }
    ],
    "limit": 3,
    "user": "user_00000000",
    "mode": "ultra"
}'
```

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- **Docker** >= 20.0
- **Docker Compose** >= 2.0  
- **å¯ç”¨å†…å­˜** >= 4GB
- **OpenAI APIå¯†é’¥**ï¼ˆæˆ–å…¼å®¹çš„APIæœåŠ¡ï¼‰

> ğŸ’¡ **æç¤º**: æ‰€æœ‰æœåŠ¡é€šè¿‡ Docker Compose ä¸€é”®éƒ¨ç½²ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£… MySQLã€Redisã€Qdrant ç­‰ç»„ä»¶

## ğŸ”§ é…ç½®è¯´æ˜

### Contextual RAGå¢å¼ºé…ç½®

ke-RAGæ”¯æŒå…ˆè¿›çš„Contextual RAGæŠ€æœ¯ï¼Œå¯ä»¥åœ¨chunkç¼–ç å‰ä¸ºæ¯ä¸ªæ–‡æ¡£ç‰‡æ®µæ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

- ä¸Šä¸‹æ–‡é¢„å¤„ç†ï¼šä¸ºæ¯ä¸ªchunkæ·»åŠ æ–‡æ¡£çº§åˆ«çš„ä¸Šä¸‹æ–‡æè¿°
- æ™ºèƒ½æ‘˜è¦ï¼šè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç»“æ„å’Œä¸»é¢˜ä¿¡æ¯
- æå‡æ£€ç´¢è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼Œå‡å°‘æ–­ç« å–ä¹‰

## ğŸ“š ä½¿ç”¨æŒ‡å—

### APIæ¥å£

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ¥å£ä½¿ç”¨ï¼š

#### 1. å¥åº·æ£€æŸ¥
```bash
GET /api/actuator/health/liveness
```

#### 2. æ–‡æ¡£ç´¢å¼•
```bash
POST /api/file/indexing
Content-Type: application/json
Authorization: Bearer {token}

{
    "query": "ä½ å¥½",
    "scope": [
        {
            "type": "file",
            "ids": [
                "FILE_ID"
            ]
        }
    ],
    "limit": 3
}
```

#### 3. æ£€ç´¢é—®ç­”
```bash
POST /api/rag/search
Content-Type: application/json
Authorization: Bearer {token}

{
    "query": "ä½ çš„é—®é¢˜",
    "file_ids": ["file1", "file2"],
    "top_k": 5
}
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
ke-RAG/
â”œâ”€â”€ app/                    # Djangoåº”ç”¨
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ handlers/          # è¯·æ±‚å¤„ç†
â”œâ”€â”€ bella_rag/                # æ ¸å¿ƒRAGæ¡†æ¶
â”‚   â”œâ”€â”€ transformations/   # æ•°æ®è½¬æ¢
â”‚   â”œâ”€â”€ vector_stores/     # å‘é‡å­˜å‚¨
â”‚   â””â”€â”€ llm/              # å¤§æ¨¡å‹æ¥å£
â”œâ”€â”€ common/                # å…¬å…±å·¥å…·
â”œâ”€â”€ conf/                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml     # Dockerç¼–æ’
â””â”€â”€ scripts/              # åˆå§‹åŒ–è„šæœ¬
```

### æ‰©å±•å¼€å‘

1. **æ·»åŠ æ–°çš„å‘é‡å­˜å‚¨**: ç»§æ‰¿ `VectorStore` åŸºç±»
2. **è‡ªå®šä¹‰æ£€ç´¢ç­–ç•¥**: å®ç° `RetrievalStrategy` æ¥å£
3. **æ–°å¢æ–‡æ¡£è§£æå™¨**: æ‰©å±• `DocumentParser` ç±»

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥Dockerå’ŒDocker Composeç‰ˆæœ¬
   - ç¡®ä¿ç«¯å£8008ã€3306ã€6379ã€6333ç­‰æœªè¢«å ç”¨
   - æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs`

2. **Elasticsearchè¿æ¥å¤±è´¥**
   - ç¡®ä¿ElasticsearchæœåŠ¡æ­£å¸¸å¯åŠ¨
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé…ç½®

3. **å‘é‡æ•°æ®åº“è¿æ¥é—®é¢˜**
   - éªŒè¯APIå¯†é’¥å’ŒURLé…ç½®
   - æ£€æŸ¥ç½‘ç»œè¿é€šæ€§

4. **å†…å­˜ä¸è¶³**
   - ç¡®ä¿ç³»ç»Ÿå¯ç”¨å†…å­˜ >= 4GB
   - æ ¹æ®éœ€è¦è°ƒæ•´Dockerå†…å­˜é™åˆ¶

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs bella-rag-api

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MITè®¸å¯è¯](LICENSE)ã€‚

## ğŸ¤ è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-08-25)
- ğŸ‰ é¦–ä¸ªæ­£å¼ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ æ”¯æŒå¤šç§å‘é‡æ•°æ®åº“ï¼ˆQdrantã€è…¾è®¯å‘é‡æ•°æ®åº“ï¼‰
- ğŸ”§ Docker Composeä¸€é”®éƒ¨ç½²
- ğŸ“š å®Œæ•´çš„APIæ¥å£å’Œæ–‡æ¡£
